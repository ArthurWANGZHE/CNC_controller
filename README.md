# 数控系统项目

## 项目概述

本项目是一个基于STM32单片机的数控系统实现，包含上位机和下位机两部分。系统能够实现直线插补和圆弧插补功能，通过串口通信实现上下位机之间的数据交互。

## 系统架构

### 上位机（Qt应用程序）

- 提供图形用户界面，用于参数设置和轨迹显示
- 通过串口向下位机发送控制命令
- 接收下位机返回的执行状态信息
- 实时显示插补轨迹

### 下位机（STM32单片机）

- 接收并解析上位机发送的命令
- 执行直线插补和圆弧插补算法
- 控制步进电机运动
- 向上位机返回执行状态

## 功能特点

1.**插补算法**：

- 直线插补：支持四个象限的直线插补
- 圆弧插补：支持顺时针和逆时针方向的圆弧插补

2.**通信协议**：

- 帧格式：`AA 55 [命令码] [数据长度] [数据] [校验和]`
- 命令码：

  - 0x01：直线插补
  - 0x02：圆弧插补
- 参数：起点坐标、终点坐标、圆心坐标、速度等

3.**电机控制**：

- 支持两轴（X轴和Y轴）步进电机控制
- X轴：PUL+接PA1，DIR+接PA2，PUL-和DIR-接GND
- Y轴：PUL+接PA3，DIR+接PA4，PUL-和DIR-接GND

## 目录结构

```

test/

├── computer/                # 上位机代码

│   └── computer/

│       ├── main.cpp         # 程序入口

│       ├── mainwindow.cpp   # 主窗口实现

│       ├── mainwindow.h     # 主窗口头文件

│       ├── plotwidget.cpp   # 绘图控件实现

│       └── plotwidget.h     # 绘图控件头文件

│

└── control/                 # 下位机代码

    ├── motor.c              # 电机控制实现

    ├── motor.h              # 电机控制头文件

    ├── usart.c              # 串口通信实现

    ├── usart.h              # 串口通信头文件

    ├── interpolation.c      # 插补算法实现

    └── ...                  # 其他支持文件

```

## 使用说明

### 硬件连接

1. 将上位机通过USB转串口模块连接到下位机的USART1
2. 步进电机连接：

   - X轴：PUL+接PA1，DIR+接PA2，PUL-和DIR-接GND
   - Y轴：PUL+接PA3，DIR+接PA4，PUL-和DIR-接GND

### 上位机操作

1. 启动上位机程序
2. 选择正确的串口和波特率
3. 点击"连接"按钮建立串口连接
4. 设置插补参数（算法类型、象限、起点、终点等）
5. 点击"运行"按钮发送命令到下位机
6. 观察轨迹显示窗口中的运动轨迹

### 下位机编译与烧录

1. 使用Keil MDK打开项目文件
2. 编译项目
3. 将程序烧录到STM32单片机

## 通信协议详解

### 命令格式

```

AA 55 [命令码] [数据长度] [数据] [校验和]

```

### 直线插补命令示例

```

AA 55 01 [数据长度] [算法类型] [象限] [起点X] [起点Y] [终点X] [终点Y] [速度] [细分值] [校验和]

```

### 圆弧插补命令示例

```

AA 55 02 [数据长度] [算法类型] [象限] [方向] [起点X] [起点Y] [终点X] [终点Y] [圆心X] [圆心Y] [速度] [细分值] [校验和]

```

## 开发环境

### 上位机

- Qt 5.x
- C++

### 下位机

- Keil MDK 5.x
- STM32F10x标准外设库

## 注意事项

1. 确保步进电机驱动器的电源供应正确
2. 连接电机前确认接线正确，避免损坏设备
3. 上位机发送命令前确保参数设置合理
4. 下位机会在命令执行完成后返回确认字节(0xAA)
